# EntitySpottedState æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

`m_entitySpottedState` æ˜¯CS2ä¸­ç”¨äºè·Ÿè¸ªå®ä½“"è¢«å‘ç°"çŠ¶æ€çš„å…³é”®æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºæ¸¸æˆçš„è§†çº¿æ£€æµ‹ç³»ç»Ÿã€‚

---

## ğŸ” `m_entitySpottedState` è¯¦è§£

### æ•°æ®ç»“æ„

```cpp
// åœ¨ C_CSPlayerPawn ç±»ä¸­
// åç§»é‡: 0x1F98
EntitySpottedState_t m_entitySpottedState;

// EntitySpottedState_t ç»“æ„å®šä¹‰
struct EntitySpottedState_t {
    // +0x8: æ˜¯å¦è¢«æœ¬åœ°ç©å®¶å‘ç°
    bool m_bSpotted;
    
    // +0xC: è¢«å“ªäº›ç©å®¶å‘ç°çš„ä½æ©ç ï¼ˆå¤šäººæ¸¸æˆï¼‰
    uint32_t m_bSpottedByMask[2];
};
```

### å­—æ®µè¯´æ˜

#### 1. `m_bSpotted` (åç§» +0x8)
- **ç±»å‹**: `bool`
- **å«ä¹‰**: è¯¥å®ä½“æ˜¯å¦åœ¨**æœ¬åœ°ç©å®¶**çš„ç›´æ¥è§†çº¿å†…
- **åˆ¤å®šæ¡ä»¶**:
  - âœ… å®ä½“åœ¨ç©å®¶è§†é‡èŒƒå›´å†…ï¼ˆFOVå†…ï¼‰
  - âœ… ç©å®¶ä¸å®ä½“ä¹‹é—´**æ— å¢™ä½“é®æŒ¡**
  - âœ… å®ä½“æœªè¢«çƒŸé›¾/é—ªå…‰å®Œå…¨é®æŒ¡
  - âœ… å®ä½“åœ¨æœ‰æ•ˆæ¸²æŸ“è·ç¦»å†…

**ç¤ºä¾‹**:
```cpp
// è¯»å–æ•Œäººçš„spottedçŠ¶æ€
uintptr_t entitySpottedState = enemyPawn + 0x1F98;
bool isSpotted = memory::Read<bool>(entitySpottedState + 0x8);

if (isSpotted) {
    // æ•Œäººå¯è§ - æ˜¾ç¤ºçº¢è‰²æ–¹æ¡†
} else {
    // æ•Œäººè¢«å¢™é®æŒ¡ - æ˜¾ç¤ºç»¿è‰²æ–¹æ¡†
}
```

#### 2. `m_bSpottedByMask` (åç§» +0xC)
- **ç±»å‹**: `uint32_t[2]` (64ä½ä½æ©ç )
- **å«ä¹‰**: åœ¨å¤šäººæ¸¸æˆä¸­ï¼Œè®°å½•å“ªäº›ç©å®¶å‘ç°äº†è¯¥å®ä½“
- **ç”¨é€”**: å›¢é˜Ÿå…±äº«è§†é‡ã€é›·è¾¾æ˜¾ç¤ºç­‰

---

## ğŸ® ä¸ºä»€ä¹ˆä½¿ç”¨ `C_CSPlayerPawn`ï¼Ÿ

### CS2ä¸­çš„å®ä½“ç±»å‹

| ç±»å | ç”¨é€” | æ˜¯å¦æœ‰ `m_entitySpottedState` |
|------|------|------------------------------|
| **`C_CSPlayerPawn`** | ç©å®¶å®ä½“ï¼ˆæ•Œäºº/é˜Ÿå‹ï¼‰ | âœ… æœ‰ |
| `C_PlantedC4` | å·²æ”¾ç½®çš„C4ç‚¸å¼¹ | âŒ æ—  |
| `C_Hostage` | äººè´¨ | âŒ æ—  |
| `C_BaseEntity` | åŸºç¡€å®ä½“ç±» | âŒ æ—  |
| `C_CSWeaponBase` | æ­¦å™¨å®ä½“ | âŒ æ—  |

### ä¸ºä»€ä¹ˆESPå¿…é¡»ä½¿ç”¨ `C_CSPlayerPawn`ï¼Ÿ

1. **ESPçš„ç›®æ ‡æ˜¯ç©å®¶**
   - ESPï¼ˆExtra Sensory Perceptionï¼‰çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯æ˜¾ç¤º**æ•Œäººç©å®¶**çš„ä½ç½®
   - åªæœ‰ `C_CSPlayerPawn` ç±»å‹çš„å®ä½“æ‰æ˜¯ç©å®¶

2. **`m_entitySpottedState` åªå­˜åœ¨äºç©å®¶å®ä½“**
   - C4ç‚¸å¼¹ã€äººè´¨ç­‰å®ä½“æ²¡æœ‰"è¢«å‘ç°"çš„æ¦‚å¿µ
   - åªæœ‰ç©å®¶å®ä½“éœ€è¦è§†çº¿æ£€æµ‹

3. **å†…å­˜åç§»é‡çš„æ­£ç¡®æ€§**
   - ä¸åŒç±»å‹çš„å®ä½“ï¼Œå†…å­˜å¸ƒå±€å®Œå…¨ä¸åŒ
   - ä½¿ç”¨é”™è¯¯çš„ç±»å‹ä¼šå¯¼è‡´è¯»å–é”™è¯¯çš„å†…å­˜åœ°å€

### é”™è¯¯ç¤ºä¾‹

```cpp
// âŒ é”™è¯¯ï¼šå°è¯•ä»C4ç‚¸å¼¹è¯»å–spottedçŠ¶æ€
uintptr_t c4Entity = ...;
uintptr_t spottedState = c4Entity + 0x1F98;  // é”™è¯¯ï¼C4æ²¡æœ‰è¿™ä¸ªå­—æ®µ
bool isSpotted = memory::Read<bool>(spottedState + 0x8);  // è¯»å–åˆ°åƒåœ¾æ•°æ®
```

### æ­£ç¡®ç¤ºä¾‹

```cpp
// âœ… æ­£ç¡®ï¼šä»ç©å®¶å®ä½“è¯»å–spottedçŠ¶æ€
uintptr_t playerPawn = ...;
uintptr_t spottedState = playerPawn + 
    cs2_dumper::schemas::client_dll::C_CSPlayerPawn::m_entitySpottedState;
bool isSpotted = memory::Read<bool>(spottedState + 0x8);
```

---

## ğŸ”§ å®é™…åº”ç”¨ï¼šå¢™åæ£€æµ‹

### å·¥ä½œåŸç†

```
æ¸¸æˆå¼•æ“æ¯å¸§æ›´æ–° m_bSpotted:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç©å®¶è§†çº¿æ£€æµ‹                        â”‚
â”‚  â”œâ”€ æ•Œäººåœ¨FOVå†…ï¼Ÿ                   â”‚
â”‚  â”œâ”€ å°„çº¿æ£€æµ‹ï¼šç©å®¶â†’æ•Œäºº             â”‚
â”‚  â”œâ”€ æ˜¯å¦ç¢°åˆ°å¢™ä½“ï¼Ÿ                  â”‚
â”‚  â””â”€ æ›´æ–° m_bSpotted                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    m_bSpotted = true/false
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æˆ‘ä»¬çš„ESPè¯»å–                       â”‚
â”‚  â”œâ”€ è¯»å– m_bSpotted                 â”‚
â”‚  â”œâ”€ true  â†’ çº¢è‰²æ–¹æ¡†ï¼ˆå¯è§ï¼‰        â”‚
â”‚  â””â”€ false â†’ ç»¿è‰²æ–¹æ¡†ï¼ˆå¢™åï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç å®ç°

```cpp
// åœ¨ esp.cpp çš„ updateEntities() ä¸­
void esp::updateEntities() {
    for (auto entity : entities) {
        // è¯»å–ç©å®¶å®ä½“çš„spottedçŠ¶æ€
        uintptr_t entitySpottedState = entity + 
            cs2_dumper::schemas::client_dll::C_CSPlayerPawn::m_entitySpottedState;
        
        // m_bSpotted åœ¨ EntitySpottedState_t çš„åç§» 0x8
        bool isSpotted = memory::Read<bool>(entitySpottedState + 0x8);
        
        // ä¿å­˜åˆ° EnemyInfo
        enemy.isSpotted = isSpotted;
    }
}

// åœ¨ esp.cpp çš„ render() ä¸­
void esp::render() {
    for (auto& enemy : enemies) {
        uint8_t r, g, b, a;
        
        if (menu::espWallCheck && !enemy.isSpotted) {
            // å¢™å - ç»¿è‰²
            r = 0; g = 255; b = 0; a = 255;
        } else {
            // å¯è§ - çº¢è‰²
            r = 255; g = 0; b = 0; a = 255;
        }
        
        sdl_renderer::draw::box(x, y, w, h, r, g, b, a);
    }
}
```

---

## ğŸ¯ è§†è§‰æ•ˆæœ

### é¢œè‰²æ–¹æ¡ˆ

| çŠ¶æ€ | é¢œè‰² | `m_bSpotted` | å«ä¹‰ |
|------|------|--------------|------|
| **å¯è§** | ğŸ”´ **çº¢è‰²** | `true` | æ•Œäººåœ¨ç›´æ¥è§†çº¿å†…ï¼Œå¯ä»¥å°„å‡» |
| **å¢™å** | ğŸŸ¢ **ç»¿è‰²** | `false` | æ•Œäººè¢«å¢™é®æŒ¡ï¼Œéœ€è¦é¢„ç„æˆ–ç©¿å¢™ |

### å®æˆ˜ç¤ºä¾‹

```
åœºæ™¯1: æ•Œäººåœ¨æ‹è§’å
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç©å®¶   â”‚ â† ä½ çš„ä½ç½®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“ è§†çº¿
    â–ˆâ–ˆâ–ˆ â† å¢™å£
     â†“
  ğŸŸ¢æ•Œäºº  â† ç»¿è‰²æ–¹æ¡†ï¼ˆm_bSpotted = falseï¼‰

åœºæ™¯2: æ•Œäººéœ²å¤´
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç©å®¶   â”‚ â† ä½ çš„ä½ç½®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“ è§†çº¿ï¼ˆæ— é®æŒ¡ï¼‰
     â†“
  ğŸ”´æ•Œäºº  â† çº¢è‰²æ–¹æ¡†ï¼ˆm_bSpotted = trueï¼‰
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™æ•Œäººæ˜æ˜å¯è§ï¼Œå´æ˜¾ç¤ºç»¿è‰²ï¼Ÿ
**A**: å¯èƒ½åŸå› ï¼š
- æ¸¸æˆå¼•æ“æ›´æ–°å»¶è¿Ÿï¼ˆçº¦0.1ç§’ï¼‰
- æ•Œäººåªéœ²å‡ºå¾ˆå°ä¸€éƒ¨åˆ†ï¼ˆå¦‚æ‰‹è‡‚ï¼‰
- çƒŸé›¾å¼¹/é—ªå…‰å¼¹å½±å“è§†çº¿åˆ¤å®š

### Q2: `m_bSpottedByMask` æœ‰ä»€ä¹ˆç”¨ï¼Ÿ
**A**: åœ¨å¤šäººæ¸¸æˆä¸­ï¼š
- è®°å½•å“ªäº›é˜Ÿå‹çœ‹åˆ°äº†è¯¥æ•Œäºº
- ç”¨äºé›·è¾¾å…±äº«è§†é‡
- æˆ‘ä»¬çš„ESPåªéœ€è¦ `m_bSpotted`ï¼Œä¸éœ€è¦è¿™ä¸ªå­—æ®µ

### Q3: èƒ½å¦ç”¨äºå…¶ä»–å®ä½“ï¼ˆå¦‚C4ã€äººè´¨ï¼‰ï¼Ÿ
**A**: ä¸èƒ½ï¼
- C4ã€äººè´¨ç­‰å®ä½“æ²¡æœ‰ `m_entitySpottedState` å­—æ®µ
- å¼ºè¡Œè¯»å–ä¼šå¾—åˆ°åƒåœ¾æ•°æ®
- åªèƒ½ç”¨äº `C_CSPlayerPawn` ç±»å‹çš„ç©å®¶å®ä½“

---

## ğŸ“Š æ€§èƒ½åˆ†æ

### å†…å­˜è¯»å–å¼€é”€

```cpp
// æ¯ä¸ªæ•Œäººåªéœ€è¦1æ¬¡é¢å¤–çš„å†…å­˜è¯»å–
bool isSpotted = memory::Read<bool>(entitySpottedState + 0x8);  // ~0.001ms
```

### ä¼˜åŠ¿
- âœ… æ— éœ€æ‰‹åŠ¨å°„çº¿æ£€æµ‹
- âœ… æ— éœ€å¤æ‚çš„ç¢°æ’è®¡ç®—
- âœ… ç›´æ¥ä½¿ç”¨æ¸¸æˆå¼•æ“çš„ç»“æœ
- âœ… æ€§èƒ½å¼€é”€æå°

---

## ğŸ”— ç›¸å…³èµ„æº

- **CS2 Dumper**: https://github.com/a2x/cs2-dumper
- **Offset**: `C_CSPlayerPawn::m_entitySpottedState = 0x1F98`
- **ç»“æ„**: `EntitySpottedState_t::m_bSpotted = +0x8`

